<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>주사랑교회 청년부 주보</title>
    
    <!-- PWA 메타 태그 -->
    <meta name="description" content="주사랑교회 청년부를 위한 모바일 주보 앱">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="청년부 주보">
    
    <!-- 매니페스트 -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- 파비콘 (기본 브라우저 아이콘 사용) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- 공통 스타일 -->
    <th:block th:replace="~{fragments/styles :: styles}"></th:block>
</head>
<body>
    <!-- 헤더 -->
    <th:block th:replace="~{fragments/header :: header(${currentDate})}"></th:block>

    <!-- 메인 컨텐츠 영역 -->
    <main id="mainContent" class="container-fluid px-3 py-3 pb-5">
        <!-- 홈 탭 컨텐츠 -->
        <div id="homeTab" class="tab-content">
            <!-- 교회 정보 -->
            <th:block th:replace="~{fragments/church-info :: church-info}"></th:block>

            <!-- 주보 보기 버튼 -->
            <section class="mb-4">
                <button onclick="openBulletinViewer()" class="btn btn-primary w-100 py-3 d-flex align-items-center justify-content-center gap-2" style="font-size: 1.125rem; font-weight: 600; border-radius: 12px; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); border: none;">
                    <i class="fas fa-book-open"></i>
                    <span>주보 보기</span>
                </button>
            </section>

        <!-- 청년부 예배 일정 -->
        <section id="schedule" class="p-4" style="background: var(--muted); background-opacity: 0.3;">
            <button onclick="toggleSection('scheduleContent')" class="w-100 mb-4 d-flex align-items-center justify-content-between group" style="background: none; border: none; padding: 0;">
                <div class="text-start">
                    <h2 class="h5 fw-bold mb-1 group-hover" style="color: var(--foreground); transition: color 0.2s;">청년부 예배 일정</h2>
                    <p style="font-size: 0.875rem; color: var(--muted-foreground);">주차별로 다양한 형태의 예배와 모임을 진행해요</p>
                </div>
                <i class="fas fa-chevron-down" id="scheduleIcon" style="color: var(--muted-foreground); transition: transform 0.3s;"></i>
            </button>
            
            <div id="scheduleContent" class="accordion-content" style="max-height: 0; overflow: hidden; opacity: 0; transition: all 0.5s ease-in-out;">

            <div class="d-flex flex-column gap-3">
                <!-- 1주차: 청년주관 오후예배 -->
                <div class="card" style="border: 1px solid var(--border); border-opacity: 0.5; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);">
                    <div class="card-body p-4">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="flex-grow-1">
                                <div class="d-flex align-items-center gap-2 mb-2">
                                    <h3 class="fw-semibold mb-0" style="color: white;">1주차: 청년주관 오후예배</h3>
                                    <span class="badge px-2 py-1 rounded-pill" style="font-size: 0.75rem; background: rgba(255,255,255,0.2); color: white;">매월 첫째주</span>
                                </div>
                                <div class="d-flex flex-column gap-1">
                                    <div class="d-flex align-items-center gap-2" style="font-size: 0.875rem; color: rgba(255,255,255,0.9);">
                                        <i class="fas fa-clock" style="width: 1rem; height: 1rem;"></i>
                                        <span>오후 2:00</span>
                                    </div>
                                    <div class="d-flex align-items-center gap-2" style="font-size: 0.875rem; color: rgba(255,255,255,0.9);">
                                        <i class="fas fa-map-marker-alt" style="width: 1rem; height: 1rem;"></i>
                                        <span>2층 예배당</span>
                                    </div>
                                </div>
                            </div>
                            <div class="text-end">
                                <i class="fas fa-users" style="font-size: 2rem; color: rgba(255,255,255,0.3);"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 2주차: 청년부 자체 예배 -->
                <div class="card" style="border: 1px solid var(--border); border-opacity: 0.5;">
                    <div class="card-body p-4">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="flex-grow-1">
                                <div class="d-flex align-items-center gap-2 mb-2">
                                    <h3 class="fw-semibold mb-0" style="color: var(--foreground);">2주차: 청년부 자체 예배</h3>
                                    <span class="badge px-2 py-1 rounded-pill" style="font-size: 0.75rem; background: var(--secondary); background-opacity: 0.8; color: var(--secondary-foreground);">매월 둘째주</span>
                                </div>
                                <div class="d-flex flex-column gap-1">
                                    <div class="d-flex align-items-center gap-2" style="font-size: 0.875rem; color: var(--muted-foreground);">
                                        <i class="fas fa-clock" style="width: 1rem; height: 1rem;"></i>
                                        <span>오후 1:00</span>
                                    </div>
                                    <div class="d-flex align-items-center gap-2" style="font-size: 0.875rem; color: var(--muted-foreground);">
                                        <i class="fas fa-map-marker-alt" style="width: 1rem; height: 1rem;"></i>
                                        <span>지하1층 중고등부실</span>
                                    </div>
                                </div>
                            </div>
                            <div class="text-end">
                                <p class="mb-0" style="font-size: 0.875rem; color: var(--muted-foreground);">예배</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 3주차: 청년부 자체 예배 -->
                <div class="card" style="border: 1px solid var(--border); border-opacity: 0.5;">
                    <div class="card-body p-4">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="flex-grow-1">
                                <div class="d-flex align-items-center gap-2 mb-2">
                                    <h3 class="fw-semibold mb-0" style="color: var(--foreground);">3주차: 청년부 자체 예배</h3>
                                    <span class="badge px-2 py-1 rounded-pill" style="font-size: 0.75rem; background: var(--secondary); background-opacity: 0.8; color: var(--secondary-foreground);">매월 셋째주</span>
                                </div>
                                <div class="d-flex flex-column gap-1">
                                    <div class="d-flex align-items-center gap-2" style="font-size: 0.875rem; color: var(--muted-foreground);">
                                        <i class="fas fa-clock" style="width: 1rem; height: 1rem;"></i>
                                        <span>오후 1:00</span>
                                    </div>
                                    <div class="d-flex align-items-center gap-2" style="font-size: 0.875rem; color: var(--muted-foreground);">
                                        <i class="fas fa-map-marker-alt" style="width: 1rem; height: 1rem;"></i>
                                        <span>지하1층 중고등부실</span>
                                    </div>
                                </div>
                            </div>
                            <div class="text-end">
                                <p class="mb-0" style="font-size: 0.875rem; color: var(--muted-foreground);">예배</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 4주차: 청년부 자체 기도회 -->
                <div class="card" style="border: 1px solid var(--border); border-opacity: 0.5; background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);">
                    <div class="card-body p-4">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="flex-grow-1">
                                <div class="d-flex align-items-center gap-2 mb-2">
                                    <h3 class="fw-semibold mb-0" style="color: white;">4주차: 청년부 자체 기도회</h3>
                                    <span class="badge px-2 py-1 rounded-pill" style="font-size: 0.75rem; background: rgba(255,255,255,0.2); color: white;">매월 넷째주</span>
                                </div>
                                <div class="d-flex flex-column gap-1">
                                    <div class="d-flex align-items-center gap-2" style="font-size: 0.875rem; color: rgba(255,255,255,0.9);">
                                        <i class="fas fa-clock" style="width: 1rem; height: 1rem;"></i>
                                        <span>오후 1:00</span>
                                    </div>
                                    <div class="d-flex align-items-center gap-2" style="font-size: 0.875rem; color: rgba(255,255,255,0.9);">
                                        <i class="fas fa-map-marker-alt" style="width: 1rem; height: 1rem;"></i>
                                        <span>지하1층 중고등부실</span>
                                    </div>
                                </div>
                            </div>
                            <div class="text-end">
                                <i class="fas fa-church" style="font-size: 2rem; color: rgba(255,255,255,0.3);"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 5주차: 애찬모임 -->
                <div class="card" style="border: 1px solid var(--border); border-opacity: 0.5; background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);">
                    <div class="card-body p-4">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="flex-grow-1">
                                <div class="d-flex align-items-center gap-2 mb-2">
                                    <h3 class="fw-semibold mb-0" style="color: white;">5주차: 애찬모임</h3>
                                    <span class="badge px-2 py-1 rounded-pill" style="font-size: 0.75rem; background: rgba(255,255,255,0.2); color: white;">5주차가 있는 달</span>
                                </div>
                                <div class="d-flex flex-column gap-1">
                                    <div class="d-flex align-items-center gap-2" style="font-size: 0.875rem; color: rgba(255,255,255,0.9);">
                                        <i class="fas fa-clock" style="width: 1rem; height: 1rem;"></i>
                                        <span>오후 1:00</span>
                                    </div>
                                    <div class="d-flex align-items-center gap-2" style="font-size: 0.875rem; color: rgba(255,255,255,0.9);">
                                        <i class="fas fa-utensils" style="width: 1rem; height: 1rem;"></i>
                                        <span>공지 확인</span>
                                    </div>
                                </div>
                            </div>
                            <div class="text-end">
                                <i class="fas fa-heart" style="font-size: 2rem; color: rgba(255,255,255,0.3);"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 안내 메시지 -->
            <div class="mt-4 p-3 rounded-3" style="background: var(--accent); background-opacity: 0.5;">
                <div class="d-flex align-items-start gap-3">
                    <i class="fas fa-info-circle" style="color: var(--primary); margin-top: 0.125rem;"></i>
                    <div>
                        <p class="fw-medium mb-1" style="color: var(--foreground); font-size: 0.875rem;">📅 주차별 예배 안내</p>
                        <p class="mb-0" style="color: var(--muted-foreground); font-size: 0.75rem; line-height: 1.4;">
                            매월 주차에 따라 다른 형태의 예배와 모임을 진행합니다. 자세한 일정은 청년부 단체 채팅방을 확인해주세요!
                        </p>
                    </div>
                </div>
            </div>
            </div>
        </section>

        <!-- 성경구절 -->
        <section class="p-4 mb-3" th:if="${not #lists.isEmpty(bulletin.bibleVerses)}" style="background: var(--muted); background-opacity: 0.3;">
            <button onclick="toggleSection('bibleContent')" class="w-100 mb-4 d-flex align-items-center justify-content-between group" style="background: none; border: none; padding: 0;">
                <div class="text-start">
                    <h2 class="h5 fw-bold mb-1 group-hover" style="color: var(--foreground); transition: color 0.2s;">성경구절</h2>
                    <p style="font-size: 0.875rem; color: var(--muted-foreground);">하나님의 말씀을 함께 나눠요</p>
                </div>
                <i class="fas fa-chevron-down" id="bibleIcon" style="color: var(--muted-foreground); transition: transform 0.3s;"></i>
            </button>
            
            <div id="bibleContent" class="accordion-content" style="max-height: 0; overflow: hidden; opacity: 0; transition: all 0.5s ease-in-out;">
                <div th:each="verse : ${bulletin.bibleVerses}">
                    <div class="card mb-3" style="border: 1px solid var(--border); border-opacity: 0.5;">
                        <div class="card-body p-4">
                            <h6 class="mb-2">
                                <i class="fas fa-bible me-2" style="color: var(--primary);"></i>
                                <span th:text="${verse.verseReference}" style="color: var(--foreground);">요한복음 3:16</span>
                            </h6>
                            <p class="mb-0" th:text="${verse.verseText}" style="color: var(--muted-foreground); line-height: 1.6;">하나님이 세상을 이처럼 사랑하사...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 교회 소식 (Announcements) -->
        <section class="p-4">
            <button onclick="toggleSection('announcementsContent')" class="w-100 mb-4 d-flex align-items-center justify-content-between group" style="background: none; border: none; padding: 0;">
                <div class="text-start">
                    <h2 class="h5 fw-bold mb-1 group-hover" style="color: var(--foreground); transition: color 0.2s;">교회 소식</h2>
                    <p style="font-size: 0.875rem; color: var(--muted-foreground);">교회의 중요한 소식들을 확인하세요</p>
                </div>
                <i class="fas fa-chevron-down" id="announcementsIcon" style="color: var(--muted-foreground); transition: transform 0.3s;"></i>
            </button>
            
            <div id="announcementsContent" class="accordion-content" style="max-height: 0; overflow: hidden; opacity: 0; transition: all 0.5s ease-in-out;">
                <!-- 소식 추가 버튼 -->
                <div class="mb-4">
                    <button onclick="openAddAnnouncementDialog()" class="btn btn-outline-primary w-100 d-flex align-items-center justify-content-center gap-2" style="border: 2px dashed var(--border); background: transparent; color: var(--primary); padding: 1rem;">
                        <i class="fas fa-plus"></i>
                        <span>소식 추가</span>
                    </button>
                </div>

            <div class="d-flex flex-column gap-3" th:if="${not #lists.isEmpty(bulletin.announcements)}">
                <div class="card border-0 shadow-sm" 
                     style="border: 1px solid var(--border); border-opacity: 0.5; transition: box-shadow 0.2s ease; cursor: pointer;"
                     onmouseover="this.style.boxShadow='0 4px 6px -1px rgba(0, 0, 0, 0.1)'; this.style.transform='scale(1.02)'"
                     onmouseout="this.style.boxShadow='0 1px 3px 0 rgba(0, 0, 0, 0.1)'; this.style.transform='scale(1)'"
                     th:onclick="'viewAnnouncement(' + ${announcement.id} + ')'"
                     th:data-id="${announcement.id}"
                     th:each="announcement : ${bulletin.announcements}">
                    <div class="card-body p-4">
                        <div class="d-flex align-items-start gap-3">
                            <!-- 아이콘 -->
                            <div class="flex-shrink-0 d-flex align-items-center justify-content-center rounded-2"
                                 style="width: 40px; height: 40px; background: var(--primary); background-opacity: 0.1;">
                                <i class="fas fa-heart" style="color: var(--primary); font-size: 1.25rem;"></i>
                            </div>

                            <!-- 내용 -->
                            <div class="flex-grow-1 min-width-0">
                                <div class="d-flex align-items-center gap-2 mb-1">
                                    <h3 class="fw-semibold mb-0" style="font-size: 0.875rem; color: var(--foreground);" th:text="${announcement.title}">새가족 환영식</h3>
                                    <span class="badge text-white px-2 py-0" 
                                          style="font-size: 0.75rem; background: var(--destructive);" 
                                          th:if="${announcement.isImportant}">중요</span>
                                    <span class="badge px-2 py-0" 
                                          style="font-size: 0.75rem; background: var(--secondary); color: var(--secondary-foreground);">행사</span>
                                </div>

                                <p class="mb-2" style="font-size: 0.875rem; color: var(--muted-foreground); line-height: 1.5;" 
                                   th:text="${announcement.content}">3월 26일(일) 오후 2시 새가족을 위한 환영식이 있습니다. 많은 참여 부탁드립니다.</p>

                                <p class="mb-0" style="font-size: 0.75rem; color: var(--muted-foreground);" 
                                   th:text="${#temporals.format(announcement.announcementDate, 'yyyy.MM.dd')}">2024.03.19</p>
                            </div>
                            
                            <!-- 편집/삭제 버튼 -->
                            <div class="d-flex gap-1" onclick="event.stopPropagation()">
                                <button th:onclick="'openEditAnnouncementDialog(' + ${announcement.id} + ')'" 
                                        th:data-id="${announcement.id}"
                                        class="btn btn-sm btn-outline-secondary" 
                                        style="width: 32px; height: 32px; padding: 0; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-edit" style="font-size: 0.75rem;"></i>
                                </button>
                                <button th:onclick="'deleteAnnouncement(' + ${announcement.id} + ')'" 
                                        th:data-id="${announcement.id}"
                                        class="btn btn-sm btn-outline-danger" 
                                        style="width: 32px; height: 32px; padding: 0; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-trash" style="font-size: 0.75rem;"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </div>
        </section>

        <!-- 연락처 & 오시는 길 (Contact) -->
        <section class="p-4" style="background: var(--muted); background-opacity: 0.3;">
            <button onclick="toggleSection('contactContent')" class="w-100 mb-4 d-flex align-items-center justify-content-between group" style="background: none; border: none; padding: 0;">
                <div class="text-start">
                    <h2 class="h5 fw-bold mb-1 group-hover" style="color: var(--foreground); transition: color 0.2s;">연락처 & 오시는 길</h2>
                    <p style="font-size: 0.875rem; color: var(--muted-foreground);">교회 정보와 찾아오는 방법</p>
                </div>
                <i class="fas fa-chevron-down" id="contactIcon" style="color: var(--muted-foreground); transition: transform 0.3s;"></i>
            </button>
            
            <div id="contactContent" class="accordion-content" style="max-height: 0; overflow: hidden; opacity: 0; transition: all 0.5s ease-in-out;">

            <!-- 연락처 정보 -->
            <div class="card mb-4" style="border: 1px solid var(--border); border-opacity: 0.5;">
                <div class="card-body p-4">
                    <h3 class="fw-semibold mb-3" style="color: var(--foreground);">연락처 정보</h3>
                    <div class="d-flex flex-column gap-3">
                        <!-- 전화번호 -->
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center gap-3">
                                <div class="d-flex align-items-center justify-content-center rounded-2" 
                                     style="width: 2rem; height: 2rem; background: var(--primary); background-opacity: 0.1;">
                                    <i class="fas fa-phone" style="font-size: 1rem; color: var(--primary);"></i>
                                </div>
                                <div>
                                    <p class="mb-0" style="font-size: 0.75rem; color: var(--muted-foreground);">전화번호</p>
                                    <p class="mb-0 fw-medium" style="font-size: 0.875rem; color: var(--foreground);">010-5240-7719</p>
                                </div>
                            </div>
                            <a href="tel:02-1234-5678" class="btn btn-outline-primary btn-sm">연결</a>
                        </div>
                        <!-- 주소 -->
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center gap-3">
                                <div class="d-flex align-items-center justify-content-center rounded-2" 
                                     style="width: 2rem; height: 2rem; background: var(--primary); background-opacity: 0.1;">
                                    <i class="fas fa-map-marker-alt" style="font-size: 1rem; color: var(--primary);"></i>
                                </div>
                                <div>
                                    <p class="mb-0" style="font-size: 0.75rem; color: var(--muted-foreground);">주소</p>
                                    <p class="mb-0 fw-medium" style="font-size: 0.875rem; color: var(--foreground);">경기 하남시 더우개로 49</p>
                                </div>
                            </div>
                            <a href="https://map.naver.com/p/search/%ED%95%98%EB%82%A8%EC%A3%BC%EC%82%AC%EB%9E%91%EA%B5%90%ED%9A%8C/place/12980252?c=15.00,0,0,0,dh&placePath=/home?entry=pll&from=map&fromPanelNum=2&timestamp=202509231735&locale=ko&svcName=map_pcv5&searchText=%ED%95%98%EB%82%A8%EC%A3%BC%EC%82%AC%EB%9E%91%EA%B5%90%ED%9A%8C" target="_blank" class="btn btn-outline-primary btn-sm">지도보기</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 교통편 -->
            <div class="card mb-4" style="border: 1px solid var(--border); border-opacity: 0.5;">
                <div class="card-body p-4">
                    <h3 class="fw-semibold mb-3" style="color: var(--foreground);">교통편</h3>
                    <div class="d-flex flex-column gap-3">
                        <div class="d-flex align-items-center gap-3">
                            <div class="d-flex align-items-center justify-content-center rounded-2" 
                                 style="width: 2rem; height: 2rem; background: var(--secondary); background-opacity: 0.5;">
                                <i class="fas fa-subway" style="font-size: 1rem; color: var(--secondary-foreground);"></i>
                            </div>
                            <div>
                                <p class="fw-medium mb-0" style="font-size: 0.875rem; color: var(--foreground);">지하철</p>
                                <p class="mb-0" style="font-size: 0.75rem; color: var(--muted-foreground);">5호선 하남시청역 1번 출구 버스 이용</p>
                            </div>
                        </div>
                        <div class="d-flex align-items-center gap-3">
                            <div class="d-flex align-items-center justify-content-center rounded-2" 
                                 style="width: 2rem; height: 2rem; background: var(--secondary); background-opacity: 0.5;">
                                <i class="fas fa-car" style="font-size: 1rem; color: var(--secondary-foreground);"></i>
                            </div>
                            <div>
                                <p class="fw-medium mb-0" style="font-size: 0.875rem; color: var(--foreground);">주차</p>
                                <p class="mb-0" style="font-size: 0.75rem; color: var(--muted-foreground);">교회 주차장 이용 가능</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 교역자 연락처 -->
            <div class="card mb-4" style="border: 1px solid var(--border); border-opacity: 0.5;">
                <div class="card-body p-4">
                    <h3 class="fw-semibold mb-3" style="color: var(--foreground);">교역자 연락처</h3>
                    <div class="d-flex flex-column gap-3">
                        <div class="d-flex align-items-center justify-content-between">
                            <div>
                                <p class="fw-medium mb-0" style="font-size: 0.875rem; color: var(--foreground);">박바울 목사</p>
                                <p class="mb-0" style="font-size: 0.75rem; color: var(--muted-foreground);">청년부 담당 목사</p>
                            </div>
                            <a href="tel:02-1234-5679" class="btn btn-outline-primary btn-sm">연락</a>
                        </div>
                        <div class="d-flex align-items-center justify-content-between">
                        </div>
                    </div>
                </div>
            </div>

            <!-- 디지털 주보 QR -->
            <div class="card" style="border: 1px solid var(--border); border-opacity: 0.5;">
                <div class="card-body p-4">
                    <div class="text-center">
                        <h3 class="fw-semibold mb-1" style="color: var(--foreground);">디지털 주보</h3>
                        <p class="mb-3" style="font-size: 0.75rem; color: var(--muted-foreground);">QR 코드를 스캔하여 온라인 주보를 확인하세요</p>
                        
                        <!-- QR 코드 이미지 -->
                        <div class="mb-3" th:if="${qrCodeImage != null}">
                            <img th:src="'data:image/png;base64,' + ${qrCodeImage}" 
                                 alt="QR 코드" 
                                 class="img-fluid rounded shadow-sm" 
                                 style="max-width: 200px; margin: 0 auto;">
                        </div>
                        
                        <!-- QR 코드가 없을 경우 아이콘 표시 -->
                        <div class="d-flex align-items-center justify-content-center rounded-2 mx-auto mb-3" 
                             th:if="${qrCodeImage == null}"
                             style="width: 4rem; height: 4rem; background: var(--primary); background-opacity: 0.1;">
                            <i class="fas fa-qrcode" style="font-size: 2rem; color: var(--primary);"></i>
                        </div>
                        
                        <!-- QR 코드 공유 버튼 -->
                        <button class="btn btn-outline-primary btn-sm" onclick="shareQRCode()">
                            <i class="fas fa-share-alt me-1"></i> 주보 공유하기
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- QR 코드 공유 스크립트 -->
            <script th:inline="javascript">
                function shareQRCode() {
                    // Railway 배포 주소 사용
                    const url = 'https://bulletin-production.up.railway.app';
                    console.log('공유할 URL:', url);
                    
                    if (navigator.share) {
                        navigator.share({
                            title: '주사랑교회 청년부 주보',
                            text: '주사랑교회 청년부 디지털 주보를 확인하세요!',
                            url: url
                        })
                        .then(() => {
                            console.log('공유 성공');
                            alert('공유가 완료되었습니다!');
                        })
                        .catch((error) => {
                            console.log('공유 실패:', error);
                            // 공유 실패 시 클립보드 복사로 대체
                            copyToClipboard(url);
                        });
                    } else {
                        // 공유 API가 지원되지 않는 경우 URL 복사
                        copyToClipboard(url);
                    }
                }
                
                function copyToClipboard(text) {
                    if (navigator.clipboard && window.isSecureContext) {
                        // HTTPS 환경에서 클립보드 API 사용
                        navigator.clipboard.writeText(text)
                            .then(() => {
                                alert('주소가 클립보드에 복사되었습니다!');
                            })
                            .catch(err => {
                                console.error('클립보드 복사 실패:', err);
                                fallbackCopyTextToClipboard(text);
                            });
                    } else {
                        // HTTP 환경에서 fallback 방법 사용
                        fallbackCopyTextToClipboard(text);
                    }
                }
                
                function fallbackCopyTextToClipboard(text) {
                    const textArea = document.createElement("textarea");
                    textArea.value = text;
                    textArea.style.position = "fixed";
                    textArea.style.left = "-999999px";
                    textArea.style.top = "-999999px";
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    
                    try {
                        const successful = document.execCommand('copy');
                        if (successful) {
                            alert('주소가 클립보드에 복사되었습니다!');
                        } else {
                            alert('복사에 실패했습니다. 수동으로 주소를 복사해주세요: ' + text);
                        }
                    } catch (err) {
                        console.error('Fallback 복사 실패:', err);
                        alert('복사에 실패했습니다. 수동으로 주소를 복사해주세요: ' + text);
                    }
                    
                    document.body.removeChild(textArea);
                }
            </script>
            </div>
        </section>
        </div>

        <!-- 주보 탭 컨텐츠 -->
        <div id="bulletinTab" class="tab-content" style="display: none;">
            <!-- 주보 뷰어 컨텐츠 -->
            <div class="text-center py-5">
                <h3>주보 보기</h3>
                <p>주보를 확인하세요</p>
            </div>
        </div>

        <!-- 일정 탭 컨텐츠 -->
        <div id="calendarTab" class="tab-content" style="display: none;">
            <div class="text-center py-5">
                <h3>일정</h3>
                <p>교회 일정을 확인하세요</p>
            </div>
        </div>

        <!-- 악보 탭 컨텐츠 -->
        <div id="musicTab" class="tab-content" style="display: none;">
            <div class="text-center py-5">
                <h3>악보</h3>
                <p>악보를 확인하세요</p>
                <a href="/sheet-music" class="btn btn-primary">악보 보러가기</a>
            </div>
        </div>

        <!-- 순모임 탭 컨텐츠 -->
        <div id="smallGroupsTab" class="tab-content" style="display: none;">
            <div class="text-center py-5">
                <h3>순모임</h3>
                <p>순모임을 확인하세요</p>
                <a href="/small-groups" class="btn btn-primary">순모임 보러가기</a>
            </div>
        </div>

        <!-- 연락처 탭 컨텐츠 -->
        <div id="contactTab" class="tab-content" style="display: none;">
            <div class="text-center py-5">
                <h3>연락처 & 오시는 길</h3>
                <p>교회 연락처와 위치를 확인하세요</p>
            </div>
        </div>
    </main>

    <!-- 하단 네비게이션 및 새로고침 버튼 -->
    <th:block th:replace="~{fragments/bottom-nav :: bottom-nav}"></th:block>
    <th:block th:replace="~{fragments/bottom-nav :: refresh-btn}"></th:block>

    <!-- 주보 뷰어 -->
    <div id="bulletinViewer" class="bulletin-viewer" style="display: none;">
        <button class="bulletin-home-btn" onclick="closeBulletinViewer()">
            <i class="fas fa-home"></i>
        </button>
        
        <button class="bulletin-edit-btn" onclick="openEditDialog()">
            <i class="fas fa-edit"></i>
        </button>
        
        <button class="bulletin-add-btn" onclick="openAddPageDialog()">
            <i class="fas fa-plus"></i>
        </button>
        
        <button class="bulletin-delete-btn" onclick="deleteCurrentPage()">
            <i class="fas fa-trash"></i>
        </button>
        
        <div class="bulletin-page-indicator">
            <span id="currentPageNum">1</span> / <span id="totalPageNum">4</span>
        </div>
        
        <div class="bulletin-container" id="bulletinContainer">
            <img id="bulletinImage" src="" alt="주보 페이지" class="bulletin-image">
        </div>
        
        <button class="bulletin-nav-btn bulletin-prev-btn" id="prevBtn" onclick="goToPrevPage()">
            <i class="fas fa-chevron-left"></i>
        </button>
        
        <button class="bulletin-nav-btn bulletin-next-btn" id="nextBtn" onclick="goToNextPage()">
            <i class="fas fa-chevron-right"></i>
        </button>
        
        <div class="bulletin-dots">
            <button class="bulletin-dot" onclick="goToPage(0)"></button>
            <button class="bulletin-dot" onclick="goToPage(1)"></button>
            <button class="bulletin-dot" onclick="goToPage(2)"></button>
            <button class="bulletin-dot" onclick="goToPage(3)"></button>
        </div>
    </div>

    <!-- 페이지 추가 모달 -->
    <div id="addPageDialog" class="edit-dialog" style="display: none;">
        <div class="edit-dialog-overlay" onclick="closeAddPageDialog()"></div>
        <div class="edit-dialog-content">
            <div class="edit-dialog-header">
                <h3 class="edit-dialog-title">새 페이지 추가</h3>
                <p class="edit-dialog-description">새로운 주보 페이지를 추가합니다.</p>
            </div>
            
            <div class="edit-dialog-body">
                <div class="form-group">
                    <label for="addPageNumber" class="form-label">페이지 번호</label>
                    <input type="number" id="addPageNumber" class="form-input" placeholder="1" min="1">
                </div>
                
                <div class="form-group">
                    <label for="addImageUrl" class="form-label">이미지 URL</label>
                    <input type="text" id="addImageUrl" class="form-input" placeholder="https://example.com/image.jpg">
                </div>
                
                <div class="form-group">
                    <label class="form-label">또는 이미지 업로드</label>
                    <div class="upload-area">
                        <input type="file" id="addImageFileInput" accept="image/*" style="display: none;">
                        <button type="button" class="btn btn-outline upload-btn" onclick="document.getElementById('addImageFileInput').click()">
                            <i class="fas fa-upload"></i> 파일 선택
                        </button>
                        <span id="addUploadFileName" class="upload-file-name"></span>
                        <div id="addUploadProgress" class="upload-progress" style="display: none;">
                            <div class="upload-progress-bar"></div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="addAlt" class="form-label">이미지 설명</label>
                    <input type="text" id="addAlt" class="form-input" placeholder="이미지 설명을 입력하세요">
                </div>
                
                <div class="form-group">
                    <label class="form-label">미리보기</label>
                    <div class="preview-container">
                        <img id="addPreviewImage" src="" alt="미리보기" class="preview-image" style="display: none;">
                    </div>
                </div>
            </div>
            
            <div class="edit-dialog-footer">
                <button class="btn btn-outline" onclick="closeAddPageDialog()">취소</button>
                <button class="btn btn-primary" onclick="saveNewPage()">추가</button>
            </div>
        </div>
    </div>

    <!-- 소식 상세보기 모달 -->
    <div id="announcementViewDialog" class="edit-dialog" style="display: none;">
        <div class="edit-dialog-overlay" onclick="closeAnnouncementViewDialog()"></div>
        <div class="edit-dialog-content">
            <div class="edit-dialog-header">
                <div class="d-flex align-items-start gap-3">
                    <div class="flex-shrink-0 d-flex align-items-center justify-content-center rounded-2" 
                         style="width: 3.5rem; height: 3.5rem; background: var(--primary); background-opacity: 0.1;">
                        <i id="viewAnnouncementIcon" class="fas fa-heart" style="color: var(--primary); font-size: 1.75rem;"></i>
                    </div>
                    <div class="flex-grow-1">
                        <h3 class="edit-dialog-title mb-2" id="viewAnnouncementTitle">새가족 환영식</h3>
                        <div class="d-flex align-items-center gap-2">
                            <span id="viewAnnouncementImportant" class="badge text-white px-2 py-1" 
                                  style="font-size: 0.75rem; background: var(--destructive); display: none;">중요</span>
                            <span id="viewAnnouncementCategory" class="badge px-2 py-1" 
                                  style="font-size: 0.75rem; background: var(--secondary); color: var(--secondary-foreground);">행사</span>
                            <span id="viewAnnouncementDate" class="text-muted" style="font-size: 0.75rem;">2024.03.19</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="edit-dialog-body">
                <p id="viewAnnouncementContent" class="mb-0" style="color: var(--foreground); line-height: 1.6; white-space: pre-wrap;">
                    3월 26일(일) 오후 2시 새가족을 위한 환영식이 있습니다. 많은 참여 부탁드립니다.
                </p>
            </div>
            
            <div class="edit-dialog-footer">
                <button class="btn btn-outline w-100" onclick="closeAnnouncementViewDialog()">닫기</button>
            </div>
        </div>
    </div>

    <!-- 소식 추가/편집 모달 -->
    <div id="announcementDialog" class="edit-dialog" style="display: none;">
        <div class="edit-dialog-overlay" onclick="closeAnnouncementDialog()"></div>
        <div class="edit-dialog-content">
            <div class="edit-dialog-header">
                <h3 class="edit-dialog-title" id="announcementDialogTitle">소식 추가</h3>
                <p class="edit-dialog-description">교회 소식을 추가하거나 수정합니다.</p>
            </div>
            
            <div class="edit-dialog-body">
                <div class="form-group">
                    <label for="announcementTitle" class="form-label">제목</label>
                    <input type="text" id="announcementTitle" class="form-input" placeholder="소식 제목을 입력하세요" required>
                </div>
                
                <div class="form-group">
                    <label for="announcementContent" class="form-label">내용</label>
                    <textarea id="announcementContent" class="form-input" placeholder="소식 내용을 입력하세요" rows="4" required></textarea>
                </div>
                
                <div class="row">
                    <div class="col-6">
                        <div class="form-group">
                            <label for="announcementCategory" class="form-label">카테고리</label>
                            <select id="announcementCategory" class="form-input">
                                <option value="행사">행사</option>
                                <option value="기도회">기도회</option>
                                <option value="모임">모임</option>
                                <option value="공지">공지</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-group">
                            <label for="announcementIcon" class="form-label">아이콘</label>
                            <select id="announcementIcon" class="form-input">
                                <option value="heart">하트</option>
                                <option value="users">사람들</option>
                                <option value="calendar">달력</option>
                                <option value="bell">종</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="announcementDate" class="form-label">날짜</label>
                    <input type="date" id="announcementDate" class="form-input" required>
                </div>
                
                <div class="form-group">
                    <div class="d-flex align-items-center justify-content-between">
                        <label for="announcementImportant" class="form-label mb-0">중요 소식</label>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="announcementImportant">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="edit-dialog-footer">
                <button class="btn btn-outline" onclick="closeAnnouncementDialog()">취소</button>
                <button class="btn btn-primary" onclick="saveAnnouncement()" id="saveAnnouncementBtn">추가</button>
            </div>
        </div>
    </div>

    <!-- 편집 모달 -->
    <div id="editDialog" class="edit-dialog" style="display: none;">
        <div class="edit-dialog-overlay" onclick="closeEditDialog()"></div>
        <div class="edit-dialog-content">
            <div class="edit-dialog-header">
                <h3 class="edit-dialog-title"><span id="editPageNum">1</span>페이지 편집</h3>
                <p class="edit-dialog-description">이미지 URL과 설명을 수정할 수 있습니다.</p>
            </div>
            
            <div class="edit-dialog-body">
                <div class="form-group">
                    <label for="editImageUrl" class="form-label">이미지 URL</label>
                    <input type="text" id="editImageUrl" class="form-input" placeholder="https://example.com/image.jpg">
                </div>
                
                <div class="form-group">
                    <label class="form-label">또는 이미지 업로드</label>
                    <div class="upload-area">
                        <input type="file" id="imageFileInput" accept="image/*" style="display: none;">
                        <button type="button" class="btn btn-outline upload-btn" onclick="document.getElementById('imageFileInput').click()">
                            <i class="fas fa-upload"></i> 파일 선택
                        </button>
                        <span id="uploadFileName" class="upload-file-name"></span>
                        <div id="uploadProgress" class="upload-progress" style="display: none;">
                            <div class="upload-progress-bar"></div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="editAlt" class="form-label">이미지 설명</label>
                    <input type="text" id="editAlt" class="form-input" placeholder="이미지 설명을 입력하세요">
                </div>
                
                <div class="form-group">
                    <label class="form-label">미리보기</label>
                    <div class="preview-container">
                        <img id="previewImage" src="" alt="미리보기" class="preview-image">
                    </div>
                </div>
            </div>
            
            <div class="edit-dialog-footer">
                <button class="btn btn-outline" onclick="closeEditDialog()">취소</button>
                <button class="btn btn-primary" onclick="saveEdit()">저장</button>
            </div>
        </div>
    </div>

    <style>
        .bulletin-viewer {
            position: fixed;
            inset: 0;
            background: var(--background);
            z-index: 9999;
        }
        
        .bulletin-home-btn, .bulletin-edit-btn, .bulletin-add-btn, .bulletin-delete-btn {
            position: absolute;
            top: 1rem;
            z-index: 20;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(8px);
            border: none;
            border-radius: 8px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .bulletin-home-btn {
            left: 1rem;
        }
        
        .bulletin-edit-btn {
            left: 4rem;
        }
        
        .bulletin-add-btn {
            left: 7rem;
            background: rgba(102, 126, 234, 0.9);
        }
        
        .bulletin-delete-btn {
            left: 10rem;
            background: rgba(239, 68, 68, 0.9);
        }
        
        .bulletin-home-btn:hover, .bulletin-edit-btn:hover {
            background: rgba(255, 255, 255, 0.9);
        }
        
        .bulletin-add-btn:hover {
            background: rgba(102, 126, 234, 1);
        }
        
        .bulletin-delete-btn:hover {
            background: rgba(239, 68, 68, 1);
        }
        
        .bulletin-home-btn i, .bulletin-edit-btn i {
            font-size: 1.25rem;
            color: var(--foreground);
        }
        
        .bulletin-add-btn i, .bulletin-delete-btn i {
            font-size: 1.25rem;
            color: white;
        }
        
        .bulletin-page-indicator {
            position: absolute;
            top: 1rem;
            right: 1rem;
            z-index: 10;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(8px);
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .bulletin-container {
            position: relative;
            width: 100%;
            height: 100%;
            background: var(--muted);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .bulletin-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            user-select: none;
        }
        
        .bulletin-nav-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(8px);
            border: none;
            border-radius: 8px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            z-index: 10;
        }
        
        .bulletin-nav-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.9);
        }
        
        .bulletin-nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .bulletin-prev-btn {
            left: 0.5rem;
        }
        
        .bulletin-next-btn {
            right: 0.5rem;
        }
        
        .bulletin-nav-btn i {
            font-size: 1.25rem;
            color: var(--foreground);
        }
        
        .bulletin-dots {
            position: absolute;
            bottom: 1.5rem;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 0.5rem;
            z-index: 10;
        }
        
        .bulletin-dot {
            width: 8px;
            height: 8px;
            border-radius: 9999px;
            background: rgba(0, 0, 0, 0.3);
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            padding: 0;
        }
        
        .bulletin-dot:hover {
            background: rgba(0, 0, 0, 0.5);
        }
        
        .bulletin-dot.active {
            background: var(--primary);
            width: 32px;
        }
        
        /* 편집 모달 스타일 */
        .edit-dialog {
            position: fixed;
            inset: 0;
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .edit-dialog-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
        
        .edit-dialog-content {
            position: relative;
            background: var(--card);
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            z-index: 10001;
        }
        
        .edit-dialog-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
        }
        
        .edit-dialog-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--foreground);
            margin: 0 0 0.5rem 0;
        }
        
        .edit-dialog-description {
            font-size: 0.875rem;
            color: var(--muted-foreground);
            margin: 0;
        }
        
        .edit-dialog-body {
            padding: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group:last-child {
            margin-bottom: 0;
        }
        
        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--foreground);
            margin-bottom: 0.5rem;
        }
        
        .form-input {
            width: 100%;
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--background);
            color: var(--foreground);
            transition: all 0.2s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(103, 126, 234, 0.1);
        }
        
        .preview-container {
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
            background: var(--muted);
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .preview-image {
            width: 100%;
            height: 200px;
            object-fit: contain;
        }
        
        .edit-dialog-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--foreground);
        }
        
        .btn-outline:hover {
            background: var(--accent);
        }
        
        .btn-primary {
            background: var(--primary);
            color: var(--primary-foreground);
        }
        
        .btn-primary:hover {
            opacity: 0.9;
        }
        
        .upload-area {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .upload-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            width: fit-content;
        }
        
        .upload-file-name {
            font-size: 0.875rem;
            color: var(--muted-foreground);
        }
        
        .upload-progress {
            width: 100%;
            height: 4px;
            background: var(--muted);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .upload-progress-bar {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.3s;
        }
    </style>

    <script>
        let bulletinPages = [];
        let currentPage = 0;
        let touchStartX = 0;
        let touchEndX = 0;
        const minSwipeDistance = 50;
        
        // API에서 주보 페이지 데이터 로드
        async function loadBulletinPages() {
            try {
                const response = await fetch('/api/bulletin-pages');
                const data = await response.json();
                bulletinPages = data.map(page => ({
                    id: page.id,
                    image: page.imageUrl,
                    alt: page.alt
                }));
                return true;
            } catch (error) {
                console.error('주보 페이지 로드 실패:', error);
                alert('주보 페이지를 불러오는데 실패했습니다.');
                return false;
            }
        }
        
        async function openBulletinViewer() {
            // 데이터가 없으면 API에서 로드
            if (bulletinPages.length === 0) {
                const loaded = await loadBulletinPages();
                if (!loaded) return;
            }
            
            document.getElementById('bulletinViewer').style.display = 'block';
            document.body.style.overflow = 'hidden';
            goToPage(0);
        }
        
        function closeBulletinViewer() {
            document.getElementById('bulletinViewer').style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        function goToPage(pageIndex) {
            currentPage = pageIndex;
            const bulletinImage = document.getElementById('bulletinImage');
            bulletinImage.src = bulletinPages[pageIndex].image;
            bulletinImage.alt = bulletinPages[pageIndex].alt;
            
            document.getElementById('currentPageNum').textContent = pageIndex + 1;
            document.getElementById('totalPageNum').textContent = bulletinPages.length;
            
            // 버튼 상태 업데이트
            document.getElementById('prevBtn').disabled = pageIndex === 0;
            document.getElementById('nextBtn').disabled = pageIndex === bulletinPages.length - 1;
            
            // 점 표시 업데이트
            const dots = document.querySelectorAll('.bulletin-dot');
            dots.forEach((dot, index) => {
                if (index === pageIndex) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            });
        }
        
        function goToNextPage() {
            if (currentPage < bulletinPages.length - 1) {
                goToPage(currentPage + 1);
            }
        }
        
        function goToPrevPage() {
            if (currentPage > 0) {
                goToPage(currentPage - 1);
            }
        }
        
        function openEditDialog() {
            const currentPageData = bulletinPages[currentPage];
            document.getElementById('editPageNum').textContent = currentPage + 1;
            document.getElementById('editImageUrl').value = currentPageData.image;
            document.getElementById('editAlt').value = currentPageData.alt;
            document.getElementById('previewImage').src = currentPageData.image;
            document.getElementById('editDialog').style.display = 'flex';
        }
        
        function closeEditDialog() {
            document.getElementById('editDialog').style.display = 'none';
        }
        
        // 페이지 추가 모달 열기
        function openAddPageDialog() {
            const nextPageNumber = bulletinPages.length + 1;
            document.getElementById('addPageNumber').value = nextPageNumber;
            document.getElementById('addImageUrl').value = '';
            document.getElementById('addAlt').value = '';
            document.getElementById('addPreviewImage').style.display = 'none';
            document.getElementById('addPageDialog').style.display = 'flex';
        }
        
        // 페이지 추가 모달 닫기
        function closeAddPageDialog() {
            document.getElementById('addPageDialog').style.display = 'none';
        }
        
        // 새 페이지 저장
        async function saveNewPage() {
            const pageNumber = parseInt(document.getElementById('addPageNumber').value);
            const imageUrl = document.getElementById('addImageUrl').value;
            const alt = document.getElementById('addAlt').value;
            
            if (!pageNumber || pageNumber < 1) {
                alert('페이지 번호를 입력해주세요.');
                return;
            }
            
            if (!imageUrl) {
                alert('이미지 URL을 입력해주세요.');
                return;
            }
            
            try {
                const response = await fetch('/api/bulletin-pages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        pageNumber: pageNumber,
                        imageUrl: imageUrl,
                        alt: alt
                    })
                });
                
                if (!response.ok) {
                    throw new Error('저장 실패');
                }
                
                // 페이지 목록 새로고침
                bulletinPages = [];
                await loadBulletinPages();
                
                // 점 표시 업데이트
                updateDots();
                
                // 새로 추가된 페이지로 이동
                goToPage(bulletinPages.length - 1);
                closeAddPageDialog();
                
                alert('새 페이지가 추가되었습니다!');
            } catch (error) {
                console.error('페이지 추가 실패:', error);
                alert('페이지 추가에 실패했습니다.');
            }
        }
        
        // 현재 페이지 삭제
        async function deleteCurrentPage() {
            if (bulletinPages.length <= 1) {
                alert('최소 1개의 페이지는 필요합니다.');
                return;
            }
            
            if (!confirm(`${currentPage + 1}페이지를 삭제하시겠습니까?`)) {
                return;
            }
            
            const pageId = bulletinPages[currentPage].id;
            
            try {
                const response = await fetch(`/api/bulletin-pages/${pageId}`, {
                    method: 'DELETE'
                });
                
                if (!response.ok) {
                    throw new Error('삭제 실패');
                }
                
                // 페이지 목록 새로고침
                bulletinPages = [];
                await loadBulletinPages();
                
                // 점 표시 업데이트
                updateDots();
                
                // 이전 페이지로 이동 (현재 페이지가 마지막이면)
                const newPage = currentPage >= bulletinPages.length ? bulletinPages.length - 1 : currentPage;
                goToPage(newPage);
                
                alert('페이지가 삭제되었습니다!');
            } catch (error) {
                console.error('페이지 삭제 실패:', error);
                alert('페이지 삭제에 실패했습니다.');
            }
        }
        
        // 점 표시 업데이트
        function updateDots() {
            const dotsContainer = document.querySelector('.bulletin-dots');
            dotsContainer.innerHTML = '';
            
            bulletinPages.forEach((_, index) => {
                const dot = document.createElement('button');
                dot.className = 'bulletin-dot';
                dot.onclick = () => goToPage(index);
                dotsContainer.appendChild(dot);
            });
        }
        
        async function saveEdit() {
            const newImageUrl = document.getElementById('editImageUrl').value;
            const newAlt = document.getElementById('editAlt').value;
            
            if (!newImageUrl) {
                alert('이미지 URL을 입력해주세요.');
                return;
            }
            
            const pageId = bulletinPages[currentPage].id;
            
            try {
                const response = await fetch(`/api/bulletin-pages/${pageId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        pageNumber: currentPage + 1,
                        imageUrl: newImageUrl,
                        alt: newAlt
                    })
                });
                
                if (!response.ok) {
                    throw new Error('저장 실패');
                }
                
                const updatedPage = await response.json();
                
                // 로컬 데이터 업데이트
                bulletinPages[currentPage].image = updatedPage.imageUrl;
                bulletinPages[currentPage].alt = updatedPage.alt;
                
                goToPage(currentPage);
                closeEditDialog();
                
                alert('페이지가 수정되었습니다!');
            } catch (error) {
                console.error('페이지 저장 실패:', error);
                alert('페이지 저장에 실패했습니다.');
            }
        }
        
        // 파일 업로드 처리
        async function uploadImageFile(file) {
            const formData = new FormData();
            formData.append('file', file);
            
            const progressBar = document.querySelector('.upload-progress-bar');
            const progressContainer = document.getElementById('uploadProgress');
            
            progressContainer.style.display = 'block';
            progressBar.style.width = '0%';
            
            try {
                // 프로그레스 바 애니메이션
                let progress = 0;
                const progressInterval = setInterval(() => {
                    progress += 10;
                    if (progress >= 90) {
                        clearInterval(progressInterval);
                    }
                    progressBar.style.width = progress + '%';
                }, 100);
                
                const response = await fetch('/api/bulletin-pages/upload-image', {
                    method: 'POST',
                    body: formData
                });
                
                clearInterval(progressInterval);
                progressBar.style.width = '100%';
                
                if (!response.ok) {
                    throw new Error('업로드 실패');
                }
                
                const data = await response.json();
                
                // 업로드된 이미지 URL 설정 (Cloudinary URL 직접 사용)
                const imageUrl = data.imageUrl;
                document.getElementById('editImageUrl').value = imageUrl;
                document.getElementById('previewImage').src = imageUrl;
                document.getElementById('uploadFileName').textContent = data.fileName;
                
                setTimeout(() => {
                    progressContainer.style.display = 'none';
                }, 500);
                
                return imageUrl;
            } catch (error) {
                console.error('이미지 업로드 실패:', error);
                alert('이미지 업로드에 실패했습니다.');
                progressContainer.style.display = 'none';
                return null;
            }
        }
        
        // 추가 페이지 이미지 업로드 처리
        async function uploadAddImageFile(file) {
            const formData = new FormData();
            formData.append('file', file);
            
            const progressBar = document.querySelector('#addUploadProgress .upload-progress-bar');
            const progressContainer = document.getElementById('addUploadProgress');
            
            progressContainer.style.display = 'block';
            progressBar.style.width = '0%';
            
            try {
                // 프로그레스 바 애니메이션
                let progress = 0;
                const progressInterval = setInterval(() => {
                    progress += 10;
                    if (progress >= 90) {
                        clearInterval(progressInterval);
                    }
                    progressBar.style.width = progress + '%';
                }, 100);
                
                const response = await fetch('/api/bulletin-pages/upload-image', {
                    method: 'POST',
                    body: formData
                });
                
                clearInterval(progressInterval);
                progressBar.style.width = '100%';
                
                if (!response.ok) {
                    throw new Error('업로드 실패');
                }
                
                const data = await response.json();
                
                // 업로드된 이미지 URL 설정
                const imageUrl = data.imageUrl;
                document.getElementById('addImageUrl').value = imageUrl;
                document.getElementById('addPreviewImage').src = imageUrl;
                document.getElementById('addPreviewImage').style.display = 'block';
                document.getElementById('addUploadFileName').textContent = data.fileName;
                
                setTimeout(() => {
                    progressContainer.style.display = 'none';
                }, 500);
                
                return imageUrl;
            } catch (error) {
                console.error('이미지 업로드 실패:', error);
                alert('이미지 업로드에 실패했습니다.');
                progressContainer.style.display = 'none';
                return null;
            }
        }
        
        // 이미지 URL 입력 시 미리보기 업데이트
        document.addEventListener('DOMContentLoaded', function() {
            // 편집 모달 이미지 URL 입력
            const editImageUrlInput = document.getElementById('editImageUrl');
            if (editImageUrlInput) {
                editImageUrlInput.addEventListener('input', function(e) {
                    const previewImage = document.getElementById('previewImage');
                    if (previewImage) {
                        previewImage.src = e.target.value || '';
                    }
                });
            }
            
            // 파일 선택 이벤트 (편집 모달)
            const imageFileInput = document.getElementById('imageFileInput');
            if (imageFileInput) {
                imageFileInput.addEventListener('change', async function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        // 파일 타입 검증
                        if (!file.type.startsWith('image/')) {
                            alert('이미지 파일만 업로드할 수 있습니다.');
                            return;
                        }
                        
                        // 파일 크기 검증 (10MB)
                        if (file.size > 10 * 1024 * 1024) {
                            alert('파일 크기는 10MB 이하여야 합니다.');
                            return;
                        }
                        
                        await uploadImageFile(file);
                    }
                });
            }
            
            // 추가 모달 이미지 URL 입력
            const addImageUrlInput = document.getElementById('addImageUrl');
            if (addImageUrlInput) {
                addImageUrlInput.addEventListener('input', function(e) {
                    const previewImage = document.getElementById('addPreviewImage');
                    if (previewImage) {
                        previewImage.src = e.target.value || '';
                        previewImage.style.display = e.target.value ? 'block' : 'none';
                    }
                });
            }
            
            // 파일 선택 이벤트 (추가 모달)
            const addImageFileInput = document.getElementById('addImageFileInput');
            if (addImageFileInput) {
                addImageFileInput.addEventListener('change', async function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        // 파일 타입 검증
                        if (!file.type.startsWith('image/')) {
                            alert('이미지 파일만 업로드할 수 있습니다.');
                            return;
                        }
                        
                        // 파일 크기 검증 (10MB)
                        if (file.size > 10 * 1024 * 1024) {
                            alert('파일 크기는 10MB 이하여야 합니다.');
                            return;
                        }
                        
                        await uploadAddImageFile(file);
                    }
                });
            }
        });
        
        // 터치 이벤트 처리
        const bulletinContainer = document.getElementById('bulletinContainer');
        
        bulletinContainer.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
            touchEndX = 0;
        });
        
        bulletinContainer.addEventListener('touchmove', (e) => {
            touchEndX = e.touches[0].clientX;
        });
        
        bulletinContainer.addEventListener('touchend', () => {
            if (!touchStartX || !touchEndX) return;
            
            const distance = touchStartX - touchEndX;
            const isLeftSwipe = distance > minSwipeDistance;
            const isRightSwipe = distance < -minSwipeDistance;
            
            if (isLeftSwipe && currentPage < bulletinPages.length - 1) {
                goToNextPage();
            }
            if (isRightSwipe && currentPage > 0) {
                goToPrevPage();
            }
        });
        
        // 키보드 네비게이션
        document.addEventListener('keydown', (e) => {
            const viewer = document.getElementById('bulletinViewer');
            if (viewer.style.display === 'none') return;
            
            if (e.key === 'ArrowLeft') {
                goToPrevPage();
            } else if (e.key === 'ArrowRight') {
                goToNextPage();
            } else if (e.key === 'Escape') {
                closeBulletinViewer();
            }
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- 탭 전환 및 아코디언 기능 스크립트 -->
    <script>
        // 탭 전환 기능
        function switchTab(tabName) {
            // 모든 탭 컨텐츠 숨기기
            const allTabs = document.querySelectorAll('.tab-content');
            allTabs.forEach(tab => {
                tab.style.display = 'none';
            });
            
            // 선택된 탭만 보이기
            const activeTab = document.getElementById(tabName + 'Tab');
            if (activeTab) {
                activeTab.style.display = 'block';
            }
            
            // 네비게이션 활성화 상태 업데이트
            updateNavigationState(tabName);
        }
        
        // 네비게이션 상태 업데이트
        function updateNavigationState(activeTab) {
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.classList.remove('active');
            });
            
            const activeNavItem = document.querySelector(`[onclick*="${activeTab}"]`);
            if (activeNavItem) {
                activeNavItem.classList.add('active');
            }
        }
        
        function toggleSection(contentId) {
            const content = document.getElementById(contentId);
            const icon = document.getElementById(contentId.replace('Content', 'Icon'));
            
            if (content.style.maxHeight === '0px' || content.style.maxHeight === '') {
                // 열기
                content.style.maxHeight = content.scrollHeight + 'px';
                content.style.opacity = '1';
                icon.style.transform = 'rotate(180deg)';
            } else {
                // 닫기
                content.style.maxHeight = '0px';
                content.style.opacity = '0';
                icon.style.transform = 'rotate(0deg)';
            }
        }
        
        // 페이지 로드 시 모든 섹션을 닫힌 상태로 설정
        document.addEventListener('DOMContentLoaded', function() {
            const accordionContents = document.querySelectorAll('.accordion-content');
            accordionContents.forEach(content => {
                content.style.maxHeight = '0px';
                content.style.opacity = '0';
            });
        });
        
        // 소식 관리 기능
        let currentEditingAnnouncementId = null;
        
        // 소식 상세보기
        async function viewAnnouncement(id) {
            try {
                const response = await fetch(`/api/announcements/${id}`);
                if (!response.ok) {
                    throw new Error('소식을 불러올 수 없습니다.');
                }
                
                const announcement = await response.json();
                
                // 모달에 데이터 설정
                document.getElementById('viewAnnouncementTitle').textContent = announcement.title;
                document.getElementById('viewAnnouncementContent').textContent = announcement.content;
                document.getElementById('viewAnnouncementDate').textContent = announcement.announcementDate;
                
                // 중요도 표시
                const importantBadge = document.getElementById('viewAnnouncementImportant');
                if (announcement.isImportant) {
                    importantBadge.style.display = 'inline-block';
                } else {
                    importantBadge.style.display = 'none';
                }
                
                // 카테고리 설정 (임시)
                document.getElementById('viewAnnouncementCategory').textContent = '행사';
                
                // 아이콘 설정 (임시)
                const iconElement = document.getElementById('viewAnnouncementIcon');
                iconElement.className = 'fas fa-heart';
                
                document.getElementById('announcementViewDialog').style.display = 'flex';
                
            } catch (error) {
                console.error('소식 조회 실패:', error);
                alert('소식을 불러오는데 실패했습니다.');
            }
        }
        
        function closeAnnouncementViewDialog() {
            document.getElementById('announcementViewDialog').style.display = 'none';
        }
        
        function openAddAnnouncementDialog() {
            currentEditingAnnouncementId = null;
            document.getElementById('announcementDialogTitle').textContent = '소식 추가';
            document.getElementById('saveAnnouncementBtn').textContent = '추가';
            
            // 폼 초기화
            document.getElementById('announcementTitle').value = '';
            document.getElementById('announcementContent').value = '';
            document.getElementById('announcementCategory').value = '행사';
            document.getElementById('announcementIcon').value = 'heart';
            document.getElementById('announcementDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('announcementImportant').checked = false;
            
            document.getElementById('announcementDialog').style.display = 'flex';
        }
        
        async function openEditAnnouncementDialog(id) {
            try {
                const response = await fetch(`/api/announcements/${id}`);
                if (!response.ok) {
                    throw new Error('소식을 불러올 수 없습니다.');
                }
                
                const announcement = await response.json();
                
                currentEditingAnnouncementId = id;
                document.getElementById('announcementDialogTitle').textContent = '소식 수정';
                document.getElementById('saveAnnouncementBtn').textContent = '수정';
                
                // 폼에 기존 데이터 설정
                document.getElementById('announcementTitle').value = announcement.title;
                document.getElementById('announcementContent').value = announcement.content;
                document.getElementById('announcementDate').value = announcement.announcementDate;
                document.getElementById('announcementImportant').checked = announcement.isImportant;
                
                document.getElementById('announcementDialog').style.display = 'flex';
                
            } catch (error) {
                console.error('소식 조회 실패:', error);
                alert('소식을 불러오는데 실패했습니다.');
            }
        }
        
        function closeAnnouncementDialog() {
            document.getElementById('announcementDialog').style.display = 'none';
        }
        
        async function saveAnnouncement() {
            const title = document.getElementById('announcementTitle').value;
            const content = document.getElementById('announcementContent').value;
            const date = document.getElementById('announcementDate').value;
            const important = document.getElementById('announcementImportant').checked;
            
            if (!title || !content) {
                alert('제목과 내용을 입력해주세요.');
                return;
            }
            
            try {
                const announcementData = {
                    title: title,
                    content: content,
                    announcementDate: date,
                    isImportant: important,
                    isActive: true,
                    displayOrder: 0,
                    startDate: null,
                    endDate: null
                };
                
                let response;
                if (currentEditingAnnouncementId) {
                    // 수정
                    response = await fetch(`/api/announcements/${currentEditingAnnouncementId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(announcementData)
                    });
                } else {
                    // 추가
                    response = await fetch('/api/announcements', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(announcementData)
                    });
                }
                
                if (!response.ok) {
                    throw new Error('저장에 실패했습니다.');
                }
                
                alert(currentEditingAnnouncementId ? '소식이 수정되었습니다!' : '소식이 추가되었습니다!');
                closeAnnouncementDialog();
                
                // 페이지 새로고침
                setTimeout(() => {
                    location.reload();
                }, 1000);
                
            } catch (error) {
                console.error('소식 저장 실패:', error);
                alert('소식 저장에 실패했습니다.');
            }
        }
        
        async function deleteAnnouncement(id) {
            if (confirm('이 소식을 삭제하시겠습니까?')) {
                try {
                    const response = await fetch(`/api/announcements/${id}`, {
                        method: 'DELETE'
                    });
                    
                    if (!response.ok) {
                        throw new Error('삭제에 실패했습니다.');
                    }
                    
                    alert('소식이 삭제되었습니다!');
                    
                    // 페이지 새로고침
                    setTimeout(() => {
                        location.reload();
                    }, 1000);
                    
                } catch (error) {
                    console.error('소식 삭제 실패:', error);
                    alert('소식 삭제에 실패했습니다.');
                }
            }
        }
    </script>
    
    <!-- 네비게이션 스크립트 -->
    <th:block th:replace="~{fragments/bottom-nav :: navigation-scripts}"></th:block>
</body>
</html>