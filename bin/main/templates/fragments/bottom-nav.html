<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<body>
    <!-- 하단 네비게이션 (Navigation) -->
    <nav class="bottom-nav" th:fragment="bottom-nav">
        <div class="d-flex align-items-center justify-content-around py-2">
            <button class="nav-item" id="nav-home" onclick="setActiveTab('home'); window.location.href='/'">
                <i class="fas fa-home"></i>
                <small>홈</small>
            </button>
            <button class="nav-item" id="nav-calendar" onclick="setActiveTab('calendar'); scrollToSection('schedule')">
                <i class="fas fa-calendar"></i>
                <small>일정</small>
            </button>
            <button class="nav-item active" id="nav-bulletin" onclick="setActiveTab('bulletin'); openBulletinViewer()">
                <i class="fas fa-book-open"></i>
                <small>주보</small>
            </button>
            <button class="nav-item" id="nav-music" onclick="setActiveTab('music'); window.location.href='/sheet-music'">
                <i class="fas fa-music"></i>
                <small>악보</small>
            </button>
            <button class="nav-item" id="nav-small-groups" onclick="setActiveTab('small-groups'); window.location.href='/small-groups'">
                <i class="fas fa-users"></i>
                <small>순모임</small>
            </button>
            <button class="nav-item" id="nav-news" onclick="setActiveTab('news'); scrollToSection('announcements')">
                <i class="fas fa-bullhorn"></i>
                <small>소식</small>
            </button>
        </div>
    </nav>

    <!-- 새로고침 버튼 -->
    <button class="refresh-btn" onclick="location.reload()" th:fragment="refresh-btn">
        <i class="fas fa-sync-alt"></i>
    </button>

    <!-- JavaScript -->
    <script th:fragment="navigation-scripts">
        // 네비게이션 활성 탭 설정
        function setActiveTab(tabId) {
            // 모든 네비게이션 아이템에서 active 클래스 제거
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // 선택된 탭에 active 클래스 추가
            const activeTab = document.getElementById('nav-' + tabId);
            if (activeTab) {
                activeTab.classList.add('active');
            }
        }
        
        // 섹션으로 부드럽게 스크롤
        function scrollToSection(sectionId) {
            let targetElement;
            
            // ID로 직접 찾기 시도
            targetElement = document.getElementById(sectionId);
            
            // ID로 찾지 못한 경우 제목으로 찾기
            if (!targetElement) {
                if (sectionId === 'schedule' || sectionId === 'calendar') {
                    // 예배 일정 섹션 찾기 - 텍스트 내용으로 검색
                    const headings = document.querySelectorAll('h2, h3, h4, h5');
                    for (let heading of headings) {
                        if (heading.textContent.includes('예배 일정')) {
                            targetElement = heading.closest('section') || heading;
                            break;
                        }
                    }
                } else if (sectionId === 'announcements') {
                    // 교회 소식 섹션 찾기 - 텍스트 내용으로 검색
                    const headings = document.querySelectorAll('h2, h3, h4, h5');
                    for (let heading of headings) {
                        if (heading.textContent.includes('교회 소식')) {
                            targetElement = heading.closest('section') || heading;
                            break;
                        }
                    }
                } else if (sectionId === 'contact') {
                    // 연락처 섹션 찾기 - 텍스트 내용으로 검색
                    const headings = document.querySelectorAll('h2, h3, h4, h5');
                    for (let heading of headings) {
                        if (heading.textContent.includes('연락처')) {
                            targetElement = heading.closest('section') || heading;
                            break;
                        }
                    }
                }
            }
            
            if (targetElement) {
                targetElement.scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        }
        
        // 페이지 로드 시 현재 경로에 따라 활성 탭 설정
        document.addEventListener('DOMContentLoaded', function() {
            const currentPath = window.location.pathname;
            
            // 모든 nav-item에서 active 클래스 제거
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // 경로에 따른 기본 활성 탭 설정
            if (currentPath === '/' || currentPath === '/mobile') {
                const homeTab = document.getElementById('nav-home');
                if (homeTab) {
                    homeTab.classList.add('active');
                }
            } else if (currentPath === '/bulletin') {
                const bulletinTab = document.getElementById('nav-bulletin');
                if (bulletinTab) {
                    bulletinTab.classList.add('active');
                }
            } else if (currentPath.startsWith('/sheet-music')) {
                const musicTab = document.getElementById('nav-music');
                if (musicTab) {
                    musicTab.classList.add('active');
                }
            } else if (currentPath.startsWith('/small-groups')) {
                const smallGroupsTab = document.getElementById('nav-small-groups');
                if (smallGroupsTab) {
                    smallGroupsTab.classList.add('active');
                }
            }
        });
    </script>
</body>
</html>
