<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<body>
    <!-- 헤더 -->
    <header th:fragment="header(currentDate)" style="position: sticky; top: 0; z-index: 50; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); border-bottom: 1px solid var(--border);">
        <div class="container" style="display: flex; height: 4rem; align-items: center; justify-content: space-between; padding: 0 1rem;">
            <!-- 좌측: 로고 + 제목 -->
            <div style="display: flex; align-items: center; gap: 0.75rem;">
                <div style="width: 2rem; height: 2rem; background: var(--primary); border-radius: 0.5rem; display: flex; align-items: center; justify-content: center;">
                    <span style="color: var(--primary-foreground); font-weight: bold; font-size: 0.875rem;">주</span>
                </div>
                <div>
                    <h1 style="font-weight: bold; font-size: 1.125rem; color: var(--foreground); margin: 0;">주사랑교회 청년부</h1>
                    <p style="font-size: 0.75rem; color: var(--muted-foreground); margin: 0;" 
                       th:text="'주보 ' + ${#temporals.format(currentDate, 'yyyy.MM.dd')}">주보 2024.03.19</p>
                </div>
            </div>

            <!-- 우측: 아이콘 버튼들 -->
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <!-- 로그인 상태에 따른 버튼 표시 -->
                <div th:if="${session.user != null}" class="user-info" style="display: flex; align-items: center; gap: 0.5rem;">
                    <span class="username-text" style="font-size: 0.875rem; color: var(--muted-foreground);" th:text="'안녕하세요, ' + ${session.username} + '님'">안녕하세요, 사용자님</span>
                    <form th:action="@{/logout}" method="post" style="display: inline;">
                        <button type="submit" class="logout-btn" style="background: var(--destructive); color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.375rem; cursor: pointer; font-size: 0.875rem; transition: background-color 0.2s; white-space: nowrap; display: flex; align-items: center; gap: 0.25rem;" 
                                onmouseover="this.style.background='var(--destructive-hover)'" 
                                onmouseout="this.style.background='var(--destructive)'">
                            <i class="fas fa-sign-out-alt"></i>
                            <span class="btn-text">로그아웃</span>
                        </button>
                    </form>
                </div>
                <div th:if="${session.user == null}" class="auth-buttons" style="display: flex; align-items: center; gap: 0.5rem;">
                    <a th:href="@{/login}" class="login-btn" style="background: var(--primary); color: var(--primary-foreground); border: none; padding: 0.5rem 1rem; border-radius: 0.375rem; text-decoration: none; font-size: 0.875rem; transition: background-color 0.2s; white-space: nowrap; display: flex; align-items: center; gap: 0.25rem;" 
                       onmouseover="this.style.background='var(--primary-hover)'" 
                       onmouseout="this.style.background='var(--primary)'">
                        <i class="fas fa-sign-in-alt"></i>
                        <span class="btn-text">로그인</span>
                    </a>
                    <a th:href="@{/register}" class="register-btn" style="background: var(--secondary); color: var(--foreground); border: 1px solid var(--border); padding: 0.5rem 1rem; border-radius: 0.375rem; text-decoration: none; font-size: 0.875rem; transition: background-color 0.2s; white-space: nowrap; display: flex; align-items: center; gap: 0.25rem;" 
                       onmouseover="this.style.background='var(--accent)'" 
                       onmouseout="this.style.background='var(--secondary)'">
                        <i class="fas fa-user-plus"></i>
                        <span class="btn-text">회원가입</span>
                    </a>
                </div>
                
                <button type="button" onclick="openQRModal()" style="background: transparent; border: none; padding: 0.5rem; cursor: pointer; border-radius: 0.375rem; transition: background-color 0.2s;" 
                        onmouseover="this.style.background='var(--accent)'" 
                        onmouseout="this.style.background='transparent'">
                    <i class="fas fa-qrcode" style="width: 1.25rem; height: 1.25rem; font-size: 1.25rem;"></i>
                </button>
                <button type="button" style="background: transparent; border: none; padding: 0.5rem; cursor: pointer; border-radius: 0.375rem; transition: background-color 0.2s;" 
                        onmouseover="this.style.background='var(--accent)'" 
                        onmouseout="this.style.background='transparent'">
                    <i class="fas fa-bell" style="width: 1.25rem; height: 1.25rem; font-size: 1.25rem;"></i>
                </button>
                <button type="button" id="menuBtn" style="background: transparent; border: none; padding: 0.5rem; cursor: pointer; border-radius: 0.375rem; transition: background-color 0.2s;" 
                        onmouseover="this.style.background='var(--accent)'" 
                        onmouseout="this.style.background='transparent'"
                        onclick="
                            var menu = document.getElementById('menuDropdown');
                            var icon = document.getElementById('menuIcon');
                            if (menu.style.display === 'none' || menu.style.display === '') {
                                menu.style.display = 'block';
                                icon.className = 'fas fa-times';
                            } else {
                                menu.style.display = 'none';
                                icon.className = 'fas fa-bars';
                            }
                        ">
                    <i id="menuIcon" class="fas fa-bars" style="width: 1.25rem; height: 1.25rem; font-size: 1.25rem;"></i>
                </button>
            </div>
        </div>

        <!-- 드롭다운 메뉴 -->
        <div id="menuDropdown" style="position: absolute; top: 4rem; left: 0; right: 0; background: var(--card); border-bottom: 1px solid var(--border); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); display: none;">
            <div class="container" style="padding: 1rem;">
                <nav style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem;">
                    <a href="/" onclick="document.getElementById('menuDropdown').style.display='none'; document.getElementById('menuIcon').className='fas fa-bars';" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; border-radius: 0.5rem; transition: background-color 0.2s; text-decoration: none; background: var(--muted); color: var(--foreground); font-weight: 500;">
                        <i class="fas fa-home" style="width: 1.25rem; height: 1.25rem; font-size: 1.25rem;"></i>
                        <span>홈</span>
                    </a>
                    <a href="javascript:void(0)" onclick="document.getElementById('menuDropdown').style.display='none'; document.getElementById('menuIcon').className='fas fa-bars'; setTimeout(function(){ document.getElementById('schedule').scrollIntoView({behavior: 'smooth'}); }, 100);" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; border-radius: 0.5rem; transition: background-color 0.2s; text-decoration: none; background: var(--muted); color: var(--foreground); font-weight: 500;">
                        <i class="fas fa-calendar" style="width: 1.25rem; height: 1.25rem; font-size: 1.25rem;"></i>
                        <span>일정</span>
                    </a>
                    <a href="javascript:void(0)" onclick="document.getElementById('menuDropdown').style.display='none'; document.getElementById('menuIcon').className='fas fa-bars'; openBulletinViewer();" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; border-radius: 0.5rem; transition: background-color 0.2s; text-decoration: none; background: var(--muted); color: var(--foreground); font-weight: 500;">
                        <i class="fas fa-book-open" style="width: 1.25rem; height: 1.25rem; font-size: 1.25rem;"></i>
                        <span>주보</span>
                    </a>
                    <a href="/sheet-music" onclick="document.getElementById('menuDropdown').style.display='none'; document.getElementById('menuIcon').className='fas fa-bars';" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; border-radius: 0.5rem; transition: background-color 0.2s; text-decoration: none; background: var(--muted); color: var(--foreground); font-weight: 500;">
                        <i class="fas fa-music" style="width: 1.25rem; height: 1.25rem; font-size: 1.25rem;"></i>
                        <span>악보</span>
                    </a>
                    <a href="/small-groups" onclick="document.getElementById('menuDropdown').style.display='none'; document.getElementById('menuIcon').className='fas fa-bars';" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; border-radius: 0.5rem; transition: background-color 0.2s; text-decoration: none; background: var(--muted); color: var(--foreground); font-weight: 500;">
                        <i class="fas fa-users" style="width: 1.25rem; height: 1.25rem; font-size: 1.25rem;"></i>
                        <span>순모임</span>
                    </a>
                    <a href="javascript:void(0)" onclick="document.getElementById('menuDropdown').style.display='none'; document.getElementById('menuIcon').className='fas fa-bars'; setTimeout(function(){ document.getElementById('bible-verses').scrollIntoView({behavior: 'smooth'}); }, 100);" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; border-radius: 0.5rem; transition: background-color 0.2s; text-decoration: none; background: var(--muted); color: var(--foreground); font-weight: 500;">
                        <i class="fas fa-book" style="width: 1.25rem; height: 1.25rem; font-size: 1.25rem;"></i>
                        <span>말씀</span>
                    </a>
                    <a href="javascript:void(0)" onclick="document.getElementById('menuDropdown').style.display='none'; document.getElementById('menuIcon').className='fas fa-bars'; setTimeout(function(){ document.getElementById('announcements').scrollIntoView({behavior: 'smooth'}); }, 100);" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; border-radius: 0.5rem; transition: background-color 0.2s; text-decoration: none; background: var(--muted); color: var(--foreground); font-weight: 500;">
                        <i class="fas fa-users" style="width: 1.25rem; height: 1.25rem; font-size: 1.25rem;"></i>
                        <span>소식</span>
                    </a>
                    <a href="javascript:void(0)" onclick="document.getElementById('menuDropdown').style.display='none'; document.getElementById('menuIcon').className='fas fa-bars'; setTimeout(function(){ var contact = document.getElementById('contact'); if(contact) contact.scrollIntoView({behavior: 'smooth'}); }, 100);" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; border-radius: 0.5rem; transition: background-color 0.2s; text-decoration: none; background: var(--muted); color: var(--foreground); font-weight: 500;">
                        <i class="fas fa-phone" style="width: 1.25rem; height: 1.25rem; font-size: 1.25rem;"></i>
                        <span>연락처</span>
                    </a>
                </nav>
            </div>
        </div>
    </header>

    <style>
        .menu-btn:hover {
            background: rgba(0, 0, 0, 0.05) !important;
        }
        
        /* 모바일 반응형 스타일 */
        @media (max-width: 768px) {
            .auth-buttons {
                gap: 0.25rem !important;
            }
            
            .login-btn,
            .register-btn {
                padding: 0.5rem !important;
                min-width: auto !important;
            }
            
            .login-btn .btn-text,
            .register-btn .btn-text {
                display: none;
            }
            
            .login-btn i,
            .register-btn i {
                margin: 0 !important;
            }
        }
        
        @media (max-width: 480px) {
            .auth-buttons {
                gap: 0.25rem !important;
            }
            
            .login-btn,
            .register-btn {
                padding: 0.5rem !important;
            }
        }
        
        /* 작은 화면에서 헤더 제목 줄이기 */
        @media (max-width: 640px) {
            header .container {
                padding: 0 0.75rem !important;
            }
            
            header .container > div:first-child {
                gap: 0.5rem !important;
            }
            
            header .container > div:first-child h1 {
                font-size: 0.875rem !important;
            }
            
            header .container > div:first-child p {
                font-size: 0.625rem !important;
            }
            
            /* 로그아웃 버튼도 모바일 반응형 */
            .user-info .username-text {
                display: none !important;
            }
            
            .logout-btn {
                padding: 0.5rem !important;
            }
            
            .logout-btn .btn-text {
                display: none !important;
            }
            
            /* 우측 아이콘 버튼들 간격 조정 */
            header .container > div:last-child {
                gap: 0.25rem !important;
            }
        }
        
        /* 매우 작은 화면 (360px 이하) */
        @media (max-width: 360px) {
            header .container > div:first-child > div:first-child {
                width: 1.5rem !important;
                height: 1.5rem !important;
            }
            
            header .container > div:first-child > div:first-child span {
                font-size: 0.75rem !important;
            }
        }
    </style>

    <script>
        // QR 모달 함수
        if (typeof window.openQRModal === 'undefined') {
            window.openQRModal = function() {
                const modal = document.getElementById('qrModal');
                if (modal) {
                    modal.style.display = 'flex';
                } else {
                    console.warn('QR 모달이 페이지에 없습니다.');
                }
            };
        }

        if (typeof window.closeQRModal === 'undefined') {
            window.closeQRModal = function() {
                const modal = document.getElementById('qrModal');
                if (modal) modal.style.display = 'none';
            };
        }
    </script>
</body>
</html>